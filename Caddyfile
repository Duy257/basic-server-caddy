# Caddyfile cho Express Basic Server
# Cấu hình này sẽ forward requests từ port 80/443 đến Express server ở port 3000

# Cấu hình cho domain (thay đổi theo domain của bạn)
localhost:8080 {
    # Reverse proxy đến Express server
    reverse_proxy 127.0.0.1:3000
    
    # Logging
    log {
        output file /var/log/caddy/access.log
        format json
    }
    
    # Headers bảo mật
    header {
        # Prevent MIME type sniffing
        X-Content-Type-Options nosniff
        
        # XSS Protection
        X-Frame-Options DENY
        
        # HSTS
        Strict-Transport-Security "max-age=31536000; includeSubDomains"
        
        # Hide Caddy version
        -Server
    }
    
    # Compression
    encode gzip
}

# Cấu hình cho production với domain thật
# mydomain.com {
#     reverse_proxy 127.0.0.1:3000
#     
#     # TLS tự động với Let's Encrypt
#     tls {
#         protocols tls1.2 tls1.3
#     }
#     
#     log {
#         output file /var/log/caddy/mydomain.log
#         format json
#     }
#     
#     header {
#         X-Content-Type-Options nosniff
#         X-Frame-Options DENY
#         Strict-Transport-Security "max-age=31536000; includeSubDomains"
#         -Server
#     }
#     
#     encode gzip
# }

# Health check endpoint
:8081 {
    respond /health "OK" 200
    
    log {
        output file /var/log/caddy/health.log
    }
}